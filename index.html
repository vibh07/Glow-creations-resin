<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Glow Creation - Luxury Jewellery</title>

    <!-- Fonts -->
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&family=Playfair+Display:wght@600;700&display=swap"
        rel="stylesheet">
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* =========================================
           1. RESET & VARIABLES
           ========================================= */
        :root {
            --primary-gold: #996515;
            --light-gold: #f4e5c4;
            --dark-bg: #1a1a1a;
            --text-dark: #2c2c2c;
            --text-grey: #777;
            --bg-body: #f0f0f0;
            --white: #ffffff;
            --shadow-soft: 0 10px 30px rgba(153, 101, 21, 0.1);
            --shadow-float: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        html,
        body {
            width: 100%;
            height: 100%;
            background-color: var(--bg-body);
            overflow: hidden;
        }

        body {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* =========================================
           2. MOBILE CONTAINER LAYOUT
           ========================================= */
        .mobile-container {
            background-color: var(--white);
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 414px;
            /* Mobile Frame */
            height: 100dvh;
            max-height: 850px;
            border-radius: 30px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
        }

        /* Mobile Fullscreen Override */
        @media screen and (max-width: 480px) {
            body {
                background-color: #fff;
                align-items: flex-start;
            }

            .mobile-container {
                max-width: 100%;
                height: 100dvh;
                border-radius: 0;
                box-shadow: none;
                max-height: none;
            }
        }

        .scrollable-content {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding-bottom: 110px;
            /* Space for Bottom Nav */
            scrollbar-width: none;
        }

        .scrollable-content::-webkit-scrollbar {
            display: none;
        }

        /* =========================================
           3. HEADER & SEARCH
           ========================================= */
        .fixed-header-group {
            position: sticky;
            top: 0;
            z-index: 50;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            padding-bottom: 10px;
        }

        .header {
            padding: 15px 20px 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo-box {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .app-logo {
            height: 40px;
            width: auto;
            object-fit: contain;
            border-radius: 100%;
        }

        .logo-text {
            font-family: 'Playfair Display', serif;
            font-size: 22px;
            font-weight: 700;
            color: var(--text-dark);
            letter-spacing: -0.5px;
        }

        .header-profile-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #fcfcfc;
            border: 1px solid #eee;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-dark);
            font-size: 18px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .header-profile-btn:active {
            transform: scale(0.95);
            background: var(--light-gold);
        }

        .search-section {
            padding: 10px 20px 5px;
            display: flex;
            gap: 10px;
        }

        .search-box {
            flex: 1;
            background: #f7f7f7;
            border: 1px solid transparent;
            border-radius: 15px;
            padding: 10px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #888;
            transition: 0.3s;
        }

        .search-box:focus-within {
            background: #fff;
            border-color: var(--primary-gold);
            box-shadow: 0 4px 15px rgba(153, 101, 21, 0.1);
        }

        .search-box input {
            border: none;
            outline: none;
            width: 100%;
            font-size: 14px;
            background: transparent;
        }

        .filter-btn {
            background: var(--primary-gold);
            color: white;
            width: 48px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(153, 101, 21, 0.3);
        }

        .filter-btn:active {
            transform: scale(0.95);
        }

        /* =========================================
           4. SECTIONS (Banner, Categories)
           ========================================= */
        .banner-wrapper {
            padding: 15px 20px;
        }

        .banner {
            background: linear-gradient(135deg, #F9F3E5 0%, #FDFBF7 100%);
            border-radius: 24px;
            padding: 25px;
            display: flex;
            position: relative;
            height: 170px;
            overflow: hidden;
            box-shadow: var(--shadow-soft);
        }

        .banner-content {
            z-index: 2;
            width: 60%;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .banner h2 {
            font-family: 'Playfair Display', serif;
            font-size: 22px;
            line-height: 1.2;
            margin-bottom: 5px;
            color: var(--text-dark);
        }

        .banner p {
            font-size: 11px;
            color: var(--text-grey);
            margin-bottom: 15px;
            font-weight: 500;
        }

        .shop-now-btn {
            background: var(--primary-gold);
            color: white;
            border: none;
            align-self: flex-start;
            padding: 8px 20px;
            border-radius: 30px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            box-shadow: 0 4px 10px rgba(153, 101, 21, 0.3);
        }

        .banner-img {
            width: 150px;
            height: 100%;
            object-fit: cover;
            position: absolute;
            right: -15px;
            bottom: 0;
            mask-image: linear-gradient(to left, black 60%, transparent);
        }

        .section-header {
            padding: 20px 20px 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-title {
            font-weight: 700;
            font-size: 17px;
            color: var(--text-dark);
        }

        .see-all {
            font-size: 12px;
            color: var(--primary-gold);
            font-weight: 600;
            cursor: pointer;
        }

        .categories {
            display: flex;
            gap: 20px;
            padding: 5px 20px 15px;
            overflow-x: auto;
            scrollbar-width: none;
        }

        .cat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            min-width: 68px;
            cursor: pointer;
        }

        .cat-icon {
            width: 58px;
            height: 58px;
            background: #fffcf5;
            border: 1px solid #efe5d0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            color: var(--primary-gold);
            transition: all 0.2s;
        }

        .cat-item:active .cat-icon {
            transform: scale(0.9);
            background: var(--primary-gold);
            color: #fff;
            box-shadow: 0 5px 15px rgba(153, 101, 21, 0.3);
        }

        .cat-name {
            font-size: 12px;
            font-weight: 500;
            color: #555;
        }

        .filters {
            display: flex;
            gap: 10px;
            padding: 0 20px 15px;
            overflow-x: auto;
            scrollbar-width: none;
        }

        .filter-chip {
            padding: 8px 20px;
            border-radius: 25px;
            border: 1px solid #eee;
            font-size: 13px;
            white-space: nowrap;
            color: #666;
            cursor: pointer;
            background: #fff;
            transition: all 0.2s;
        }

        .filter-chip.active {
            background: var(--primary-gold);
            color: white;
            border-color: var(--primary-gold);
            box-shadow: 0 4px 10px rgba(153, 101, 21, 0.2);
        }

        /* =========================================
           5. PRODUCT GRID
           ========================================= */
        .product-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            padding: 5px 20px 20px;
        }

        .product-card {
            background: #fff;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.03);
            border: 1px solid #f9f9f9;
            transition: transform 0.2s;
        }

        .product-card:active {
            transform: scale(0.98);
        }

        .prod-img-box {
            height: 170px;
            width: 100%;
            background: #f9f9f9;
            position: relative;
        }

        .prod-img-box img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .fav-icon {
            position: absolute;
            top: 12px;
            right: 12px;
            background: rgba(255, 255, 255, 0.95);
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: #333;
            z-index: 5;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            cursor: pointer;
        }

        .fav-icon.active {
            color: #e74c3c;
            background: #fff5f5;
        }

        .cart-btn-product {
            position: absolute;
            bottom: 12px;
            right: 12px;
            background: var(--primary-gold);
            color: white;
            width: 34px;
            height: 34px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            z-index: 5;
            box-shadow: 0 4px 10px rgba(153, 101, 21, 0.4);
        }

        .prod-details {
            padding: 12px 15px;
        }

        .prod-title {
            font-size: 13px;
            font-weight: 600;
            color: #333;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 4px;
        }

        .prod-price {
            font-size: 15px;
            font-weight: 700;
            color: var(--primary-gold);
        }

        /* =========================================
           6. BOTTOM NAVIGATION
           ========================================= */
        .bottom-nav-container {
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            width: 92%;
            z-index: 1000;
        }

        .bottom-nav {
            background: rgba(30, 30, 30, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 40px;
            height: 75px;
            display: flex;
            justify-content: space-evenly;
            align-items: center;
            box-shadow: var(--shadow-float);
            padding: 0 10px;
        }

        .nav-item {
            color: rgba(255, 255, 255, 0.5);
            font-size: 20px;
            cursor: pointer;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .nav-item.active {
            background: #ffffff;
            color: var(--primary-gold);
            transform: translateY(-8px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .nav-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            background: #ff4757;
            color: white;
            font-size: 10px;
            font-weight: 700;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #1e1e1e;
        }

        /* =========================================
           7. POPUPS & OVERLAYS
           ========================================= */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(3px);
            z-index: 1050;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        .overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        /* Generic Popup Style */
        .wishlist-popup,
        .cart-popup {
            position: absolute;
            bottom: -100%;
            left: 0;
            width: 100%;
            background: #fff;
            border-radius: 35px 35px 0 0;
            box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.15);
            z-index: 1100;
            transition: bottom 0.4s cubic-bezier(0.19, 1, 0.22, 1);
            /* Smooth spring */
            padding: 25px;
            display: flex;
            flex-direction: column;
        }

        .wishlist-popup {
            height: 75%;
        }

        .cart-popup {
            height: 90%;
        }

        .wishlist-popup.open,
        .cart-popup.open {
            bottom: 0;
        }

        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f0f0f0;
        }

        .popup-title {
            font-size: 20px;
            font-weight: 700;
            color: var(--text-dark);
            font-family: 'Playfair Display', serif;
        }

        .close-popup {
            font-size: 24px;
            color: #aaa;
            cursor: pointer;
            padding: 5px;
        }

        .wishlist-grid,
        .cart-items-container {
            overflow-y: auto;
            scrollbar-width: none;
            padding-bottom: 20px;
            flex: 1;
        }

        .wishlist-grid::-webkit-scrollbar,
        .cart-items-container::-webkit-scrollbar {
            display: none;
        }

        /* Item Rows (Cart/Wishlist/Orders) */
        .cart-item,
        .wishlist-item,
        .order-card {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            background: #fff;
            border: 1px solid #f5f5f5;
            border-radius: 16px;
            padding: 12px;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.02);
        }

        .cart-item img,
        .wishlist-item img,
        .order-card .order-img {
            width: 70px;
            height: 70px;
            border-radius: 12px;
            object-fit: cover;
        }

        .cart-item-details,
        .wishlist-details,
        .order-info {
            flex: 1;
        }

        .item-title,
        .order-title {
            font-size: 14px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }

        .item-price,
        .order-meta {
            font-size: 14px;
            font-weight: 700;
            color: var(--primary-gold);
        }

        .cart-custom-badge {
            font-size: 10px;
            background: #fdf6e7;
            padding: 3px 8px;
            border-radius: 6px;
            color: #8a6d3b;
            margin-top: 5px;
            display: inline-block;
            font-weight: 500;
        }

        .action-btn-icon {
            width: 36px;
            height: 36px;
            background: #fff5f5;
            color: #e74c3c;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 14px;
            transition: 0.2s;
        }

        .action-btn-icon:active {
            transform: scale(0.9);
        }

        .cart-footer {
            border-top: 1px solid #f0f0f0;
            padding-top: 20px;
            margin-top: auto;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 15px;
            color: #333;
        }

        .place-order-btn,
        .btn-fill {
            width: 100%;
            background: var(--dark-bg);
            color: white;
            padding: 16px;
            border-radius: 18px;
            border: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        .place-order-btn:active,
        .btn-fill:active {
            transform: scale(0.98);
            opacity: 0.9;
        }

        /* Order Status Badges */
        .order-status {
            font-size: 11px;
            padding: 4px 10px;
            border-radius: 20px;
            font-weight: 600;
            display: inline-block;
            margin-top: 6px;
        }

        .status-green {
            background: #e8f5e9;
            color: #2e7d32;
        }

        .status-orange {
            background: #fff8e1;
            color: #fbc02d;
        }

        .status-blue {
            background: #e3f2fd;
            color: #1976d2;
        }

        /* =========================================
           8. CENTER MODALS (Auth, Checkout, Success)
           ========================================= */
        .modal-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 2000;
            display: none;
            justify-content: center;
            align-items: center;
        }

        .custom-wizard {
            background: white;
            width: 90%;
            max-width: 360px;
            max-height: 85%;
            border-radius: 24px;
            padding: 25px;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: popUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popUp {
            from {
                opacity: 0;
                transform: scale(0.9);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .wizard-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 20px;
            color: var(--primary-gold);
            font-family: 'Playfair Display', serif;
        }

        .wizard-label {
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 8px;
            display: block;
            color: #444;
        }

        /* Form Inputs */
        .input-group {
            margin-bottom: 15px;
        }

        .custom-input {
            width: 100%;
            padding: 14px;
            border: 1px solid #eaeaea;
            border-radius: 12px;
            font-size: 14px;
            background: #fbfbfb;
            transition: 0.3s;
        }

        .custom-input:focus {
            background: #fff;
            border-color: var(--primary-gold);
            outline: none;
            box-shadow: 0 0 0 4px rgba(153, 101, 21, 0.1);
        }

        .option-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 15px;
        }

        .option-btn {
            border: 1px solid #eee;
            padding: 12px;
            border-radius: 12px;
            text-align: center;
            font-size: 13px;
            cursor: pointer;
            color: #555;
            background: #fff;
        }

        .option-btn.selected {
            background: var(--primary-gold);
            color: white;
            border-color: var(--primary-gold);
            font-weight: 600;
        }

        .wizard-actions {
            display: flex;
            justify-content: space-between;
            gap: 15px;
            margin-top: 25px;
        }

        .btn-outline {
            background: transparent;
            border: 1px solid #ccc;
            padding: 12px 25px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 600;
            color: #666;
        }

        /* Success Animation */
        .success-checkmark {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            position: relative;
        }

        .check-icon {
            width: 80px;
            height: 80px;
            position: relative;
            border-radius: 50%;
            box-sizing: content-box;
            border: 4px solid #4CAF50;
        }

        .check-icon::before {
            top: 3px;
            left: -2px;
            width: 30px;
            transform-origin: 100% 50%;
            border-radius: 100px 0 0 100px;
        }

        .check-icon::after {
            top: 0;
            left: 30px;
            width: 60px;
            transform-origin: 0 50%;
            border-radius: 0 100px 100px 0;
            animation: rotate-circle 4.25s ease-in;
        }

        .check-icon::before,
        .check-icon::after {
            content: '';
            height: 100px;
            position: absolute;
            background: #FFFFFF;
            transform: rotate(-45deg);
        }

        .icon-line {
            height: 5px;
            background-color: #4CAF50;
            display: block;
            border-radius: 2px;
            position: absolute;
            z-index: 10;
        }

        .line-tip {
            top: 46px;
            left: 14px;
            width: 25px;
            transform: rotate(45deg);
            animation: icon-line-tip 0.75s;
        }

        .line-long {
            top: 38px;
            right: 8px;
            width: 47px;
            transform: rotate(-45deg);
            animation: icon-line-long 0.75s;
        }

        .icon-circle {
            top: -4px;
            left: -4px;
            z-index: 10;
            width: 80px;
            height: 80px;
            border-radius: 50%;
            position: absolute;
            box-sizing: content-box;
            border: 4px solid rgba(76, 175, 80, .5);
        }

        .icon-fix {
            top: 8px;
            width: 5px;
            left: 26px;
            z-index: 1;
            height: 85px;
            position: absolute;
            transform: rotate(-45deg);
            background-color: #FFFFFF;
        }

        @keyframes icon-line-tip {
            0% {
                width: 0;
                left: 1px;
                top: 19px;
            }

            54% {
                width: 0;
                left: 1px;
                top: 19px;
            }

            70% {
                width: 50px;
                left: -8px;
                top: 37px;
            }

            84% {
                width: 17px;
                left: 21px;
                top: 48px;
            }

            100% {
                width: 25px;
                left: 14px;
                top: 46px;
            }
        }

        @keyframes icon-line-long {
            0% {
                width: 0;
                right: 46px;
                top: 54px;
            }

            65% {
                width: 0;
                right: 46px;
                top: 54px;
            }

            84% {
                width: 55px;
                right: 0px;
                top: 35px;
            }

            100% {
                width: 47px;
                right: 8px;
                top: 38px;
            }
        }

        .empty-msg {
            text-align: center;
            color: #999;
            margin-top: 50px;
            font-size: 14px;
            width: 100%;
        }

        /* Auth Buttons */
        .google-btn {
            background: #fff;
            border: 1px solid #e0e0e0;
            padding: 14px;
            width: 100%;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-weight: 500;
            color: #444;
            cursor: pointer;
            margin-top: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.03);
            transition: 0.2s;
        }

        .google-btn:active {
            background: #f9f9f9;
            transform: scale(0.98);
        }

        .logout-btn {
            background: #fff0f0;
            color: #d32f2f;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 20px auto 0;
        }

        /* =========================================
   TOAST NOTIFICATION (Premium UI)
   ========================================= */
        .toast-container {
            position: fixed;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 5000;
            /* Sabse upar */
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 90%;
            max-width: 400px;
            pointer-events: none;
            /* Click through empty space */
        }

        .toast-box {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(12px);
            padding: 16px 20px;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            gap: 15px;
            pointer-events: auto;
            transition: all 0.3s ease;
            animation: toastSlideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
            border: 1px solid rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
            touch-action: none;
            /* Important for swipe */
        }

        /* Status Bars (Left Line) */
        .toast-box::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 5px;
        }

        .toast-success::before {
            background: #2e7d32;
        }

        /* Green */
        .toast-error::before {
            background: #d32f2f;
        }

        /* Red */
        .toast-info::before {
            background: var(--primary-gold);
        }

        /* Gold */

        /* Icon Styles */
        .toast-icon {
            font-size: 20px;
        }

        .toast-success .toast-icon {
            color: #2e7d32;
        }

        .toast-error .toast-icon {
            color: #d32f2f;
        }

        .toast-info .toast-icon {
            color: var(--primary-gold);
        }

        /* Text Styles */
        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            font-size: 14px;
            color: #333;
            margin-bottom: 2px;
        }

        .toast-msg {
            font-size: 12px;
            color: #666;
            font-weight: 400;
        }

        /* Close Button */
        .toast-close {
            color: #999;
            font-size: 16px;
            cursor: pointer;
            padding: 5px;
        }

        /* Animations */
        @keyframes toastSlideIn {
            from {
                opacity: 0;
                transform: translateY(-50px) scale(0.9);
            }

            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        @keyframes toastFadeOut {
            to {
                opacity: 0;
                transform: translateY(-20px) scale(0.95);
            }
        }

        /* --- STEP 2: FIX STORE POPUP UI --- */

        /* Popup ke andar Grid ko sahi shape dena */
        #storePopup .product-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            /* 2 Columns fix */
            gap: 15px;
            padding: 15px;
            padding-bottom: 100px;
            /* Scroll ke liye space */
        }

        /* Card ki height fix karein taaki image na kate */
        #storePopup .product-card {
            height: auto;
            min-height: 240px;
            /* Kam se kam itni height rahe */
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        /* Image box ko fix height dein */
        #storePopup .prod-img-box {
            height: 170px !important;
            /* Force height */
            width: 100%;
        }

        /* Images ko box ke andar fit karein */
        #storePopup .prod-img-box img {
            object-fit: cover;
            height: 100%;
            width: 100%;
            border-radius: 20px 20px 0 0;
        }

        /* Filters ko thoda saaf dikhayein */
        #storePopup .filters {
            padding: 10px 15px 15px;
            gap: 10px;
        }

        #storePopup .filter-chip {
            padding: 8px 16px;
            font-size: 13px;
            background: #f5f5f5;
            border: none;
        }

        #storePopup .filter-chip.active {
            background: var(--primary-gold);
            color: white;
            box-shadow: 0 4px 10px rgba(153, 101, 21, 0.2);
        }

        /* =========================================
   STEP 1: STORE POPUP UI FIXES
   ========================================= */

        /* 1. Popup Background */
        #storePopup {
            background-color: #f9f9f9;
            /* Thoda grey background taaki cards pop karein */
            padding: 0;
            /* Padding hatayein taaki header chipak sake */
            display: flex;
            flex-direction: column;
        }

        /* 2. Header aur Filter ko Sticky banayein (Scroll karte waqt upar rahenge) */
        #storePopup .popup-header {
            background: #fff;
            padding: 20px 20px 10px 20px;
            position: sticky;
            top: 0;
            z-index: 20;
            border-radius: 30px 30px 0 0;
            flex-shrink: 0;
        }

        #storePopup .filters {
            background: #fff;
            padding: 5px 20px 15px 20px;
            position: sticky;
            top: 60px;
            /* Header ke neeche */
            z-index: 19;
            border-bottom: 1px solid #eee;
            flex-shrink: 0;
            margin-bottom: 0;
        }

        /* 3. Product Grid ko 2 Columns mein Force karein */
        #storePopup .product-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            /* Exact 2 columns */
            gap: 15px;
            padding: 20px;
            padding-bottom: 120px;
            /* Bottom space taaki last item dikhe */
            overflow-y: auto;
            background: #f9f9f9;
        }

        /* 4. Card Design Fix */
        #storePopup .product-card {
            background: #fff;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.03);
            border: 1px solid #eee;
            display: flex;
            flex-direction: column;
            height: auto;
        }

        /* 5. IMAGE HEIGHT FIX (Sabse Important) */
        #storePopup .prod-img-box {
            width: 100%;
            height: 160px !important;
            /* Force height */
            position: relative;
            background: #f0f0f0;
        }

        #storePopup .prod-img-box img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            /* Image ko crop karke fit karega */
            display: block;
        }

        /* 6. Details styling */
        #storePopup .prod-details {
            padding: 12px;
        }

        #storePopup .prod-title {
            font-size: 13px;
            margin-bottom: 5px;
            font-weight: 500;
        }

        #storePopup .prod-price {
            font-size: 14px;
            font-weight: 700;
            color: var(--primary-gold);
        }

        /* --- STORE POPUP FILTER STYLES (Isolated) --- */
        .store-chip {
            padding: 8px 20px;
            border-radius: 25px;
            border: 1px solid #eee;
            font-size: 13px;
            white-space: nowrap;
            color: #666;
            cursor: pointer;
            background: #fff;
            transition: all 0.2s;
            display: inline-block;
            /* Line me lane ke liye */
        }

        /* Jab click ho to Gold ho jaye */
        .store-chip.active {
            background: var(--primary-gold);
            color: white;
            border-color: var(--primary-gold);
            box-shadow: 0 4px 10px rgba(153, 101, 21, 0.2);
        }

        /* --- CUSTOM BUILDER STYLES --- */
        .builder-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .b-option {
            border: 1px solid #eee;
            padding: 12px;
            border-radius: 12px;
            text-align: center;
            font-size: 13px;
            cursor: pointer;
            background: #fff;
            transition: 0.2s;
        }

        .b-option:active {
            transform: scale(0.95);
        }

        .b-option.active {
            background: var(--primary-gold);
            color: white;
            border-color: var(--primary-gold);
            font-weight: 600;
        }

        .color-grid {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        .color-opt {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border: 2px solid transparent;
        }

        .color-opt.active {
            transform: scale(1.1);
            border-color: #333;
        }

        .slider-group {
            margin-bottom: 15px;
        }

        .slider-group label {
            display: block;
            font-size: 13px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .custom-slider {
            width: 100%;
            -webkit-appearance: none;
            height: 6px;
            background: #eee;
            border-radius: 5px;
            outline: none;
        }

        .custom-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 20px;
            height: 20px;
            background: var(--primary-gold);
            border-radius: 50%;
            cursor: pointer;
        }
        /* --- PROFESSIONAL BUILDER CSS --- */
.step-box { margin-bottom: 25px; }
.step-label { font-size: 14px; font-weight: 700; color: #333; margin-bottom: 12px; display: block; letter-spacing: 0.5px; }

/* Category Grid */
.builder-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
.b-opt {
    border: 1px solid #eee; background: #fff; padding: 12px 5px; border-radius: 12px;
    text-align: center; font-size: 11px; color: #555; cursor: pointer; transition: 0.2s;
}
.b-opt i { font-size: 18px; margin-bottom: 5px; color: #888; transition: 0.2s; }
.b-opt.active { border-color: var(--primary-gold); background: #fff9ec; color: var(--primary-gold); font-weight: 600; }
.b-opt.active i { color: var(--primary-gold); }

/* Shape Grid */
.shape-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
.s-opt { 
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    padding: 10px; border: 1px solid #eee; border-radius: 12px; font-size: 11px; color: #555; cursor: pointer;
}
.s-opt.active { border-color: var(--primary-gold); background: #fff9ec; font-weight: 600; color: var(--primary-gold); }
.s-icon { width: 30px; height: 30px; margin-bottom: 5px; display: flex; align-items: center; justify-content: center; font-size: 16px; }
.s-round { border-radius: 50%; border: 2px solid #ccc; }
.s-square { border: 2px solid #ccc; }
.s-tri { width: 0; height: 0; border-left: 10px solid transparent; border-right: 10px solid transparent; border-bottom: 18px solid #ccc; }
.s-oval { width: 30px; height: 20px; border-radius: 50%; border: 2px solid #ccc; }
.active .s-round, .active .s-square, .active .s-oval { border-color: var(--primary-gold); }
.active .s-tri { border-bottom-color: var(--primary-gold); }

/* Sliders */
.size-msg { background: #e8f5e9; color: #2e7d32; padding: 12px; border-radius: 8px; font-size: 13px; text-align: center; }
.slider-box { margin-bottom: 15px; }
.slider-head { display: flex; justify-content: space-between; font-size: 13px; margin-bottom: 8px; color: #555; }
.slider-val { font-weight: 700; color: var(--primary-gold); }
.gold-slider {
    width: 100%; -webkit-appearance: none; height: 6px; background: #eee; border-radius: 5px; outline: none;
}
.gold-slider::-webkit-slider-thumb {
    -webkit-appearance: none; width: 22px; height: 22px; background: var(--primary-gold); border-radius: 50%; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
}

/* Colors */
.color-row { display: flex; gap: 20px; justify-content: center; margin-top: 10px; }
.c-circle { width: 45px; height: 45px; border-radius: 50%; cursor: pointer; border: 3px solid transparent; box-shadow: 0 5px 15px rgba(0,0,0,0.1); transition: 0.2s; }
.c-circle.active { transform: scale(1.15); border-color: #333; }
.gold { background: radial-gradient(circle at 30% 30%, #FFD700, #FDB931); }
.silver { background: radial-gradient(circle at 30% 30%, #f5f5f5, #bdbdbd); }
.copper { background: radial-gradient(circle at 30% 30%, #e0a986, #a86341); }

/* Upload & Inputs */
.input-modern { 
    width: 100%; padding: 12px; border: 1px solid #ddd; border-radius: 10px; font-size: 13px; outline: none; transition: 0.3s; 
}
.input-modern:focus { border-color: var(--primary-gold); background: #fffcf5; }

.upload-zone {
    border: 2px dashed #ddd; border-radius: 12px; padding: 20px;
    text-align: center; margin-top: 15px; cursor: pointer; transition: 0.2s;
    background: #fdfdfd; display: flex; flex-direction: column; align-items: center;
}
.upload-zone:active { background: #f0f0f0; border-color: #bbb; }
.upload-icon { font-size: 24px; color: var(--primary-gold); margin-bottom: 8px; }
#uploadText { font-size: 12px; color: #777; }
.img-preview { width: 100%; height: 120px; object-fit: contain; border-radius: 8px; margin-top: 10px; border: 1px solid #eee; }
/* --- PRODUCT DETAILS MODAL CSS --- */
.gallery-container { position: relative; background: #f9f9f9; }

.main-img-box {
    width: 100%; height: 300px; display: flex; align-items: center; justify-content: center;
    background: #fff; overflow: hidden;
}
.main-img-box img { width: 100%; height: 100%; object-fit: cover; transition: 0.3s; }

.fav-badge-detail {
    position: absolute; top: 15px; right: 15px; width: 40px; height: 40px;
    background: rgba(255,255,255,0.9); border-radius: 50%; display: flex; align-items: center; justify-content: center;
    font-size: 18px; color: #333; cursor: pointer; box-shadow: 0 4px 10px rgba(0,0,0,0.1);
}

/* Thumbnails */
.thumb-row {
    display: flex; gap: 10px; padding: 15px; overflow-x: auto; scrollbar-width: none;
}
.thumb-img {
    width: 60px; height: 60px; border-radius: 10px; object-fit: cover; 
    border: 2px solid transparent; cursor: pointer; opacity: 0.7; transition: 0.2s;
}
.thumb-img.active { border-color: var(--primary-gold); opacity: 1; transform: scale(1.05); }

/* Details Text */
.detail-block { margin-top: 20px; padding-top: 20px; border-top: 1px solid #f0f0f0; }
.detail-block h4 { font-size: 14px; font-weight: 700; margin-bottom: 10px; color: #333; }

.specs-list { list-style: none; padding: 0; }
.specs-list li { 
    display: flex; justify-content: space-between; font-size: 13px; 
    padding: 8px 0; border-bottom: 1px dashed #eee; color: #555;
}
.specs-list li span:first-child { font-weight: 600; color: #333; }
/* --- HIDE SCROLLBAR IN MODAL --- */
.scroll-hide::-webkit-scrollbar {
    display: none; /* Chrome/Safari/Webkit */
}
.scroll-hide {
    scrollbar-width: none; /* Firefox */
    -ms-overflow-style: none; /* IE/Edge */
}
/* Similar Products Scroll Styling */
#similarProductsRow::-webkit-scrollbar { display: none; }
#similarProductsRow { -ms-overflow-style: none; scrollbar-width: none; }

/* Close Button Hover */
.fas.fa-times:hover { color: #e74c3c; transform: scale(1.1); transition: 0.2s; }
    </style>
</head>

<body>
    <div class="toast-container" id="toastContainer"></div>
    <div class="mobile-container">

        <!-- === SCROLLABLE CONTENT START === -->
        <div class="scrollable-content">

            <!-- 1. Header -->
            <div class="fixed-header-group">
                <div class="header">
                    <div class="logo-box">
                        <img src="./logo.png" alt="Glow" class="app-logo"
                            onerror="this.src='https://via.placeholder.com/40'">
                        <span class="logo-text">Glow creation</span>
                    </div>
                    <div class="header-profile-btn" onclick="openProfile()">
                        <i class="far fa-user"></i>
                    </div>
                </div>

                <div class="search-section">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Search rings, necklaces...">
                    </div>
                    <div class="filter-btn"><i class="fas fa-sliders-h"></i></div>
                </div>
            </div>

            <!-- 2. Banner -->
            <div class="banner-wrapper">
                <div class="banner">
                    <div class="banner-content">
                        <h2>Exclusive Gold Collection</h2>
                        <p>30% Off on Premium Diamond Sets</p>
                        <button class="shop-now-btn">Explore Now</button>
                    </div>
                    <img src="https://images.unsplash.com/photo-1573408301185-9146fe634ad0?ixlib=rb-1.2.1&auto=format&fit=crop&w=500&q=60"
                        class="banner-img">
                </div>
            </div>

            <!-- 3. Categories -->
            <div class="section-header">
                <span class="section-title">Category</span> <span class="see-all">See All</span>
            </div>
            <div class="categories">
                <div class="cat-item">
                    <div class="cat-icon"><i class="fas fa-ring"></i></div><span class="cat-name">Ring</span>
                </div>
                <div class="cat-item">
                    <div class="cat-icon"><i class="far fa-gem"></i></div><span class="cat-name">Pendant</span>
                </div>
                <div class="cat-item">
                    <div class="cat-icon"><i class="fas fa-link"></i></div><span class="cat-name">Bracelet</span>
                </div>
                <div class="cat-item">
                    <div class="cat-icon"><i class="far fa-dot-circle"></i></div><span class="cat-name">Bangles</span>
                </div>
                <div class="cat-item">
                    <div class="cat-icon"><i class="fas fa-infinity"></i></div><span class="cat-name">Chain</span>
                </div>
                <div class="cat-item">
                    <div class="cat-icon"><i class="fas fa-key"></i></div><span class="cat-name">Key</span>
                </div>
                <div class="cat-item">
                    <div class="cat-icon"><i class="fas fa-gift"></i></div><span class="cat-name">Gift</span>
                </div>
                <div class="cat-item">
                    <div class="cat-icon"><i class="far fa-image"></i></div><span class="cat-name">Frame</span>
                </div>
                <div class="cat-item">
                    <div class="cat-icon"><i class="fas fa-mobile-alt"></i></div><span class="cat-name">Case</span>
                </div>
            </div>

            <!-- 4. Trending -->
            <div class="section-header">
                <span class="section-title">Trending</span>
            </div>
            <div class="filters">
                <div class="filter-chip active">All</div>
                <div class="filter-chip">Gold</div>
                <div class="filter-chip">Silver</div>
                <div class="filter-chip">Diamond</div>
                <div class="filter-chip">Newest</div>
            </div>
            <!-- 5. Product Grid -->
            <div class="product-grid" id="productContainer">
                <!-- Data inserted by JS -->
            </div>
        </div>
        <!-- === SCROLLABLE CONTENT END === -->
        <!-- === FIXED BOTTOM LAYERS === -->

        <!-- Overlay for Modals -->
        <div class="overlay" id="overlay"></div>

        <!-- A. Wishlist Popup -->
        <div class="wishlist-popup" id="wishlistPopup">
            <div class="popup-header">
                <span class="popup-title">My Favourites ❤️</span>
                <span class="close-popup" onclick="closePopup('wishlistPopup')">&times;</span>
            </div>
            <div class="wishlist-grid" id="wishlistContainer">
                <div class="empty-msg">No items loved yet!</div>
            </div>
        </div>

        <!-- B. Cart Popup -->
        <div class="cart-popup" id="cartPopup">
            <div class="popup-header">
                <span class="popup-title">Shopping Bag 🛍️</span>
                <span class="close-popup" onclick="closePopup('cartPopup')">&times;</span>
            </div>
            <div class="cart-items-container" id="cartItemsList">
                <!-- Cart Items -->
            </div>
            <div class="cart-footer">
                <div class="total-row"><span>Total</span><span id="cartTotal">$0.00</span></div>
                <button class="place-order-btn" onclick="initiateCheckout()">Proceed to Checkout</button>
            </div>
        </div>

        <!-- C. My Orders Popup -->
        <div class="cart-popup" id="ordersPopup">
            <div class="popup-header">
                <span class="popup-title">My Orders 📦</span>
                <span class="close-popup" onclick="closePopup('ordersPopup')">&times;</span>
            </div>
            <div class="cart-items-container" id="ordersList">
                <!-- Orders JS se aayenge -->
            </div>
        </div>
        <div class="cart-popup" id="storePopup">
            <div class="popup-header">
                <span class="popup-title">Full Collection 💎</span>
                <span class="close-popup" onclick="closePopup('storePopup')">&times;</span>
            </div>

            <div class="filters" style="padding: 0 0 0 5px; margin-bottom: 10px; border-bottom: 1px solid #f0f0f0;">
                <div class="store-chip active" onclick="renderStorePopup('All', this)">All</div>
                <div class="store-chip" onclick="renderStorePopup('Ring', this)">Rings</div>
                <div class="store-chip" onclick="renderStorePopup('Pendant', this)">Pendants</div>
                <div class="store-chip" onclick="renderStorePopup('Bracelet', this)">Bracelets</div>
                <div class="store-chip" onclick="renderStorePopup('Bangle', this)">Bangles</div>
                <div class="store-chip" onclick="renderStorePopup('Keychain', this)">Keychain</div>
                <div class="store-chip" onclick="renderStorePopup('Mobile case', this)">Mobile case</div>
                <div class="store-chip" onclick="renderStorePopup('Keepsake', this)">Keepsake</div>
                <div class="store-chip" onclick="renderStorePopup('Frame', this)">Frame</div>
                <div class="store-chip" onclick="renderStorePopup('Chain', this)">Chain</div>
            </div>

            <div class="product-grid" id="storeGrid" style="padding: 20px; padding-bottom: 80px; overflow-y: auto;">
            </div>
        </div>
        <!-- D. Bottom Navigation -->
        <div class="bottom-nav-container">
            <div class="bottom-nav">
                <div class="nav-item active" id="nav-home" onclick="navAction('home')"><i class="fas fa-home"></i></div>
                <div class="nav-item" id="nav-store" onclick="navAction('shop')"><i class="fas fa-store"></i></div>
                <div class="nav-item" id="nav-heart" onclick="navAction('heart')"><i class="far fa-heart"></i></div>
                <div class="nav-item" id="nav-shop" onclick="navAction('cart')">
                    <i class="fas fa-shopping-bag"></i>
                    <div class="nav-badge" id="cartBadge" style="display:none">0</div>
                </div>
                <div class="nav-item" id="nav-orders" onclick="navAction('orders')"><i class="fas fa-box-open"></i>
                </div>
                
            </div>
        </div>


        <!-- === CENTER MODALS === -->

        <!-- 1. Customization Prompt -->
        <div class="modal-overlay" id="promptModal" style="z-index: 4100;">
            <div class="custom-wizard" style="text-align: center; height: auto;">
                <h3 class="wizard-title" style="margin-bottom:10px;">Customize?</h3>
                <p style="color: #666; margin-bottom: 25px; font-size: 13px;">Do you want to add personal touches?</p>
                <div style="display: flex; gap: 15px; justify-content: center;">
                    <button class="btn-outline" onclick="addToCartSimple()">No, Simple</button>
                    <button class="btn-fill" onclick="openBuilder()">Design from Scratch ✨</button>
                </div>
            </div>
        </div>

        <!-- 2. Customization Wizard -->
        <div class="modal-overlay" id="wizardModal">
            <div class="custom-wizard">
                <div class="wizard-title">Customize Item</div>

                <!-- Just showing the final step logic for cleanliness as per previous setup -->
                <div class="input-group">
                    <label class="wizard-label">Special Note / Engraving</label>
                    <textarea id="customNote" rows="4" class="custom-input"
                        placeholder="E.g. Size 12, Name 'Rahul'..."></textarea>
                </div>

                <div class="wizard-actions">
                    <button class="btn-outline" onclick="closeWizard()">Cancel</button>
                    <button class="btn-fill" onclick="finalizeCustomCart()">Add to Cart</button>
                </div>
            </div>
        </div>

        <!-- 3. Auth Modal -->
        <div class="modal-overlay" id="authModal">
            <div class="custom-wizard" style="text-align: center; height: auto;">
                <div style="margin-bottom:15px; display:flex; justify-content:center;">
                    <img src="./logo.png"
                        style="width:60px; height:60px; object-fit:contain; border-radius:50%; background:#1a1a1a; padding:5px;">
                </div>
                <h3 class="wizard-title" style="margin-bottom: 5px;">Welcome</h3>
                <p style="color: #666; font-size: 13px; margin-bottom: 20px;">Sign in to sync your wishlist & orders.
                </p>

                <button id="googleLoginBtn" class="google-btn">
                    <i class="fab fa-google" style="color:#DB4437"></i> Continue with Google
                </button>

                <button class="btn-outline" onclick="closeAuthModal()"
                    style="margin-top: 15px; border:none; width:auto; padding:5px 20px;">Cancel</button>
            </div>
        </div>

        <!-- 4. User Profile -->
        <div class="modal-overlay" id="userProfileModal">
            <div class="custom-wizard" style="text-align: center; height: auto;">
                <img id="userPhoto" src=""
                    style="width: 80px; height: 80px; border-radius: 50%; border: 3px solid var(--primary-gold); margin: 0 auto 10px; padding:2px;">
                <h3 id="userName" style="font-size: 18px; font-weight:700; color:#333;">User Name</h3>
                <p id="userEmail" style="color: #777; font-size: 12px;">email@example.com</p>

                <button class="logout-btn" id="logoutBtn">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
                <button class="btn-outline" onclick="closeUserModal()"
                    style="margin-top: 15px; border:none;">Close</button>
            </div>
        </div>

        <!-- 5. Checkout Modal -->
        <div class="modal-overlay" id="checkoutModal">
            <div class="custom-wizard" style="max-height: 85vh;">
                <div class="popup-header" style="margin-bottom:15px;">
                    <span class="popup-title" style="font-size:18px;">Checkout 💳</span>
                    <span class="close-popup" onclick="closeCheckout()" style="font-size:20px;">&times;</span>
                </div>

                <!-- STEP 1: SHIPPING -->
                <div id="checkoutStep1">
                    <div class="input-group">
                        <label class="wizard-label">Full Name</label>
                        <input type="text" id="chkName" class="custom-input" placeholder="Recipient Name">
                    </div>
                    <div class="input-group">
                        <label class="wizard-label">Phone Number</label>
                        <input type="tel" id="chkPhone" class="custom-input" placeholder="+91...">
                    </div>
                    <div class="input-group">
                        <label class="wizard-label">Delivery Address</label>
                        <textarea id="chkAddr" class="custom-input" rows="3"
                            placeholder="Full Address with Pincode"></textarea>
                    </div>
                    <button class="btn-fill" onclick="goToSummary()">Proceed to Pay</button>
                </div>

                <!-- STEP 2: SUMMARY -->
                <div id="checkoutStep2" style="display:none;">
                    <div
                        style="background:#f8f9fa; padding:15px; border-radius:15px; font-size:13px; margin-bottom:20px; border:1px solid #eee;">
                        <strong style="color:var(--text-dark)">Delivering to:</strong><br>
                        <span id="summaryName" style="font-weight:600;"></span> (<span id="summaryPhone"></span>)<br>
                        <span id="summaryAddr"
                            style="color:#666; display:block; margin-top:4px; line-height:1.4;"></span>
                    </div>

                    <div
                        style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px; padding:10px 0; border-top:1px dashed #ddd; border-bottom:1px dashed #ddd;">
                        <span style="font-weight:600; color:#555;">Total Amount</span>
                        <span id="checkoutTotal"
                            style="font-weight:700; font-size:20px; color:var(--primary-gold)">$0.00</span>
                    </div>

                    <div class="wizard-actions">
                        <button class="btn-outline" onclick="backToStep1()">Edit</button>
                        <button class="btn-fill" id="confirmOrderBtn" onclick="confirmOrder()">Confirm Order</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-overlay" id="customBuilderModal" style="z-index: 4200;">
    <div class="custom-wizard" style="max-height: 90vh; width: 95%; max-width: 420px; padding: 0; border-radius: 20px;">
        
        <div class="popup-header" style="padding: 18px 25px; border-bottom: 1px solid #f0f0f0; background: #fff;">
            <span class="popup-title" style="font-size: 18px; font-family: 'Playfair Display', serif;">Customize Your Glow ✨</span>
            <span class="close-popup" onclick="closeBuilder()" style="font-size: 24px;">&times;</span>
        </div>

        <div style="padding: 20px 25px; overflow-y: auto; flex: 1; background: #fcfcfc;">
            
            <div class="step-box">
                <label class="step-label">1. Choose Category</label>
                <div class="builder-grid">
                    <div class="b-opt" onclick="setCat(this, 'Ring')"><i class="fas fa-ring"></i><br>Ring</div>
                    <div class="b-opt" onclick="setCat(this, 'Bangles')"><i class="far fa-circle"></i><br>Bangles</div>
                    <div class="b-opt" onclick="setCat(this, 'Pendant')"><i class="far fa-gem"></i><br>Pendant</div>
                    <div class="b-opt" onclick="setCat(this, 'Bracelet')"><i class="fas fa-link"></i><br>Bracelet</div>
                    <div class="b-opt" onclick="setCat(this, 'Keychain')"><i class="fas fa-key"></i><br>Keychain</div>
                    <div class="b-opt" onclick="setCat(this, 'Frame')"><i class="far fa-image"></i><br>Frame</div>
                    <div class="b-opt" onclick="setCat(this, 'Mobile Case')"><i class="fas fa-mobile-alt"></i><br>Case</div>
                    <div class="b-opt" onclick="setCat(this, 'Keepsake')"><i class="fas fa-heart"></i><br>Keepsake</div>
                    <div class="b-opt" onclick="setCat(this, 'Mangalsutra')"><i class="fas fa-infinity"></i><br>M.Sutra</div>
                </div>
            </div>

            <div class="step-box">
                <label class="step-label">2. Select Shape</label>
                <div class="shape-grid">
                    <div class="s-opt" onclick="setShape(this, 'Round')"><div class="s-icon s-round"></div>Round</div>
                    <div class="s-opt" onclick="setShape(this, 'Heart')"><div class="s-icon"><i class="fas fa-heart"></i></div>Heart</div>
                    <div class="s-opt" onclick="setShape(this, 'Square')"><div class="s-icon s-square"></div>Square</div>
                    <div class="s-opt" onclick="setShape(this, 'Triangle')"><div class="s-icon s-tri"></div>Triangle</div>
                    <div class="s-opt" onclick="setShape(this, 'Oval')"><div class="s-icon s-oval"></div>Oval</div>
                    <div class="s-opt" onclick="setShape(this, 'Infinity')"><div class="s-icon"><i class="fas fa-infinity"></i></div>Infinity</div>
                </div>
            </div>

            <div class="step-box" id="sizeSection">
                <label class="step-label">3. Select Size</label>
                
                <div id="sizeStd" class="size-msg">
                    <i class="fas fa-check-circle"></i> Standard Size (Fit for All)
                </div>

                <div id="sizeCust" style="display:none;">
                    <div class="slider-box">
                        <div class="slider-head"><span>Length</span><span class="slider-val"><span id="txtLen">5</span> inch</span></div>
                        <input type="range" min="1" max="24" value="5" step="0.5" class="gold-slider" oninput="document.getElementById('txtLen').innerText=this.value">
                    </div>
                    <div class="slider-box">
                        <div class="slider-head"><span>Breadth</span><span class="slider-val"><span id="txtWid">4</span> inch</span></div>
                        <input type="range" min="1" max="12" value="4" step="0.5" class="gold-slider" oninput="document.getElementById('txtWid').innerText=this.value">
                    </div>
                </div>
            </div>

            <div class="step-box">
                <label class="step-label">4. Select Material Color</label>
                <div class="color-row">
                    <div class="c-circle gold" onclick="setColor(this, 'Gold')"></div>
                    <div class="c-circle silver" onclick="setColor(this, 'Silver')"></div>
                    <div class="c-circle copper" onclick="setColor(this, 'Copper')"></div>
                </div>
                <div id="selectedColorName" style="text-align:center; font-size:12px; margin-top:5px; color:#666;">Select a color</div>
            </div>

            <div class="step-box">
                <label class="step-label">5. Personalization</label>
                <textarea id="custDesc" class="input-modern" rows="3" placeholder="Type names, dates, or specific instructions..."></textarea>
                
                <input type="text" id="custLink" class="input-modern" placeholder="Paste YouTube/Insta Link (Optional)" style="margin-top:10px;">

                <div class="upload-zone" onclick="document.getElementById('fileInput').click()">
                    <input type="file" id="fileInput" accept="image/*" hidden onchange="handleFileSelect(this)">
                    <i class="fas fa-cloud-upload-alt upload-icon"></i>
                    <span id="uploadText">Upload Reference Image</span>
                    <img id="previewImg" class="img-preview" style="display:none;">
                </div>
            </div>

        </div>

        <div class="popup-footer" style="padding: 15px 25px; border-top: 1px solid #f0f0f0; background: #fff;">
            <button class="btn-fill" onclick="submitCustomOrder()">Add Custom Item - $999</button>
        </div>
    </div>
</div>
        <!-- 6. Success Modal -->
        <div class="modal-overlay" id="successModal" style="z-index: 3500;">
            <div class="custom-wizard" style="text-align: center; height: auto;">
                <div class="success-checkmark">
                    <div class="check-icon">
                        <span class="icon-line line-tip"></span>
                        <span class="icon-line line-long"></span>
                        <div class="icon-circle"></div>
                        <div class="icon-fix"></div>
                    </div>
                </div>
                <h3 style="color:#2e7d32; font-family:'Playfair Display', serif; margin-bottom:5px;">Order Placed!</h3>
                <p style="color:#666; font-size:13px;">Thank you for shopping with Glow.</p>
            </div>
        </div>
        <div class="modal-overlay" id="productDetailModal" style="z-index: 4000;">
    <div class="custom-wizard" style="max-height: 90vh; width: 95%; max-width: 420px; padding: 0; overflow: hidden; display: flex; flex-direction: column; position: relative;">
        
        <div style="position: absolute; top: 15px; right: 15px; z-index: 20; background: rgba(255,255,255,0.8); border-radius: 50%; width: 35px; height: 35px; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 5px rgba(0,0,0,0.1);" onclick="closeProductModal()">
            <i class="fas fa-times" style="font-size: 16px; color: #333;"></i>
        </div>

        <div class="scroll-hide" style="overflow-y: auto; flex: 1; padding-bottom: 20px;">
            
            <div class="gallery-container">
                <div class="main-img-box" style="height: 350px;">
                    <img id="detailMainImg" src="" alt="Main Product">
                    <span class="fav-badge-detail" id="detailFavBtn" onclick="toggleDetailFav()" style="top: 15px; left: 15px; right: auto;">
                        <i class="far fa-heart"></i>
                    </span>
                </div>
                <div class="thumb-row" id="detailThumbRow"></div>
            </div>

            <div style="padding: 20px 20px 0;">
                <div style="display:flex; justify-content:space-between; align-items:flex-start;">
                    <div>
                        <div id="detailCat" style="font-size:11px; color:#888; text-transform:uppercase; letter-spacing:1px; margin-bottom:5px;">Category</div>
                        <h2 id="detailTitle" style="font-size: 20px; font-family:'Playfair Display', serif; color:#222; margin-bottom:5px;">Product Name</h2>
                    </div>
                    <div id="detailPrice" style="font-size: 20px; font-weight:700; color:var(--primary-gold);">$0.00</div>
                </div>

                <div class="detail-block">
                    <h4>Description</h4>
                    <p id="detailDesc" style="color:#666; font-size:13px; line-height:1.6;">...</p>
                </div>

                <div class="detail-block">
                    <h4>Specifications</h4>
                    <ul class="specs-list"></ul>
                </div>
            </div>

            <div style="padding: 20px; background: #fdfdfd; border-top: 1px solid #f0f0f0; margin-top: 20px;">
                <h4 style="font-size: 14px; font-weight: 700; color: #333; margin-bottom: 15px;">You May Also Like ✨</h4>
                <div id="similarProductsRow" style="display: flex; gap: 15px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none;">
                    </div>
            </div>

        </div>

        <div style="padding: 15px 20px; background: #fff; border-top: 1px solid #eee; display: flex; gap: 15px;">
            <button class="btn-outline" style="flex:1; border-color:var(--primary-gold); color:var(--primary-gold);" onclick="openBuilder()">
                Customize ✨
            </button>
            <button class="btn-fill" style="flex:1;" onclick="addToCartFromDetail()">
                Add to Bag
            </button>
        </div>
    </div>
</div>

    </div> <!-- Mobile Container End -->

    <!-- Load Data -->
    <script src="data.js"></script>

    <!-- MAIN SCRIPT (Logic Preserved, Formatted) -->
    <script type="module">
        // 1. IMPORTS
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
       import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged, setPersistence, browserLocalPersistence } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, set, push, update, onValue, get, query, orderByChild, equalTo } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // 2. CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyDUB2MY4FyAai9FgZ-6EZP9K9nmsUk5mb4",
            authDomain: "glow-creation.firebaseapp.com",
            databaseURL: "https://glow-creation-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "glow-creation",
            storageBucket: "glow-creation.firebasestorage.app",
            messagingSenderId: "236856410532",
            appId: "1:236856410532:web:2253fb7f215f7a232f8131",
            measurementId: "G-34FVP1W4E1"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        setPersistence(auth, browserLocalPersistence).catch((error) => console.error(error));
        const db = getDatabase(app);
        const provider = new GoogleAuthProvider();

        // 3. STATE
        // 3. STATE & CACHING (Fast Load ⚡)
window.cart = JSON.parse(localStorage.getItem('localCart')) || [];
window.wishlist = JSON.parse(localStorage.getItem('localWishlist')) || [];
let currentProductToAdd = null;
let currentUser = null; 

// Initial Load - Turant dikhao!
updateCartCount();

// --- SAVE FUNCTION ---
function saveLocally() {
    localStorage.setItem('localCart', JSON.stringify(window.cart));
    localStorage.setItem('localWishlist', JSON.stringify(window.wishlist));
    updateCartCount();
}

        // --- CLOUD SYNC ---
        function syncCartToCloud() {
            if (!currentUser) return;
            update(ref(db, 'users/' + currentUser.uid), { cart: window.cart });
        }
        function syncWishlistToCloud() {
            if (!currentUser) return;
            update(ref(db, 'users/' + currentUser.uid), { wishlist: window.wishlist });
        }

        // --- CORE LOGIC ---
        window.loadProducts = function (filterType = 'All') {
            const container = document.getElementById('productContainer');
            if (typeof products === 'undefined') { container.innerHTML = "<div class='empty-msg'>Data Loading...</div>"; return; }

            let displayList = [];
            if (filterType === 'Trending' || filterType === 'All') {
                if (filterType === 'All') displayList = products;
                else displayList = products.filter(p => p.isTrending);
            } else if (filterType === 'Newest') {
                displayList = [...products].reverse();
            } else {
                displayList = products.filter(p => p.category === filterType || p.name.includes(filterType));
            }

            if (displayList.length === 0) { container.innerHTML = "<div class='empty-msg'>No items found.</div>"; return; }

            let html = '';
            displayList.forEach(p => {
                const isLiked = window.wishlist.some(item => item.id === p.id) ? 'active' : '';
                html += `
                    <div class="product-card">
                        <div class="prod-img-box">
                            <span class="fav-icon ${isLiked}" onclick="toggleLike(${p.id}, this)">
                                <i class="${isLiked ? 'fas' : 'far'} fa-heart"></i>
                            </span>
                            <span class="cart-btn-product" onclick="initiateAddToCart(${p.id})">
                                <i class="fas fa-plus"></i>
                            </span>
                            <img src="${p.image}" loading="lazy">
                        </div>
                        <div class="prod-details">
                            <div class="prod-title">${p.name}</div>
                            <div class="prod-price">$${p.price}</div>
                        </div>
                    </div>`;
            });
            container.innerHTML = html;
        };

        // Filter Listeners
        document.querySelectorAll('.filter-chip').forEach(chip => {
            chip.addEventListener('click', function () {
                document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active')); this.classList.add('active');
                const t = this.innerText;
                if (t === 'Gold' || t === 'Silver' || t === 'Diamond') window.loadProducts(t);
                else window.loadProducts(t);
            });
        });
        // --- CATEGORY CLICK LOGIC (Updated) ---
        // Jab Home Page par kisi Category (Ring, Pendant etc.) par click ho:
        document.querySelectorAll('.cat-item').forEach(item => {
            item.addEventListener('click', function () {

                // 1. Category ka naam nikalo (e.g. "Ring")
                const categoryName = this.querySelector('.cat-name').innerText;

                // 2. Sabse pehle 'Shop' Popup open karo (Overlay aur Tabs handle karne ke liye)
                window.navAction('shop');

                // 3. Ab Popup ke andar wahi filter apply karo
                // Hum check karenge ki kya Popup me us naam ka button (chip) hai?
                // Agar hai, to usse 'active' (Gold) kar denge.
                const chips = document.querySelectorAll('.store-chip');
                let targetBtn = null;

                chips.forEach(chip => {
                    if (chip.innerText === categoryName) targetBtn = chip;
                });

                // 4. Data Filter karke show karo
                // Note: Agar button nahi bhi mila (jaise 'Gift'), tab bhi data filter hokar dikhega
                window.renderStorePopup(categoryName, targetBtn);
            });
        });

        // Wishlist
        window.toggleLike = function (id, el) {
            if (!currentUser) { document.getElementById('authModal').style.display = 'flex'; return; }
            const prod = products.find(p => p.id === id);
            const idx = window.wishlist.findIndex(p => p.id === id);
            if (idx === -1) {
                window.wishlist.push(prod);
                el.classList.add('active'); el.querySelector('i').classList.replace('far', 'fas');
            } else {
                window.wishlist.splice(idx, 1);
                el.classList.remove('active'); el.querySelector('i').classList.replace('fas', 'far');
            }
            renderWishlist(); syncWishlistToCloud();
        };
        window.renderWishlist = function () {
            const list = document.getElementById('wishlistContainer');
            if (window.wishlist.length === 0) { list.innerHTML = "<div class='empty-msg'>No favorites yet!</div>"; return; }
            list.innerHTML = window.wishlist.map(item => `
                <div class="wishlist-item">
                    <img src="${item.image}">
                    <div class="wishlist-details">
                        <div class="item-title">${item.name}</div>
                        <div class="item-price">$${item.price}</div>
                    </div>
                    <div class="action-btn-icon" onclick="toggleLike(${item.id}, this.parentElement)">
                        <i class="fas fa-trash"></i>
                    </div>
                </div>
            `).join('');
        };

        // Cart
        window.initiateAddToCart = function (id) {
            if (!currentUser) { document.getElementById('authModal').style.display = 'flex'; return; }
            currentProductToAdd = products.find(p => p.id === id);
            document.getElementById('promptModal').style.display = 'flex';
        };
        window.addToCartSimple = function () {
            window.cart.push({ ...currentProductToAdd, isCustom: false });
            document.getElementById('promptModal').style.display = 'none';
            updateCartCount(); syncCartToCloud();
            // Optional: Show small toast here instead of alert
            window.showToast("Added to Bag", "You can check it in your cart.", "success");
        };
        window.startCustomization = function () {
            document.getElementById('promptModal').style.display = 'none';
            document.getElementById('wizardModal').style.display = 'flex';
        };
        window.finalizeCustomCart = function () {
            const note = document.getElementById('customNote').value;
            window.cart.push({ ...currentProductToAdd, isCustom: true, note: note });
            document.getElementById('wizardModal').style.display = 'none';
            updateCartCount(); syncCartToCloud(); window.showToast("Custom Item Added!");
        };
        window.removeCartItem = function (index) {
            window.cart.splice(index, 1);
            renderCart(); updateCartCount(); syncCartToCloud();
        }
        function updateCartCount() {
            const badge = document.getElementById('cartBadge');
            if (window.cart.length > 0) { badge.style.display = 'flex'; badge.innerText = window.cart.length; }
            else { badge.style.display = 'none'; }
        }
        // --- UPDATE CART RENDER (Shows Custom Details) ---
        // --- UPDATED RENDER CART (Supports Custom Images) ---
// --- UPDATED RENDER CART (Shows Uploaded Image inside Details) ---
window.renderCart = function() {
    const list = document.getElementById('cartItemsList');
    const totalEl = document.getElementById('cartTotal');
    
    if(window.cart.length === 0){ 
        list.innerHTML="<div class='empty-msg'>Your bag is empty.</div>"; 
        totalEl.innerText="$0.00"; 
        return; 
    }

    let total = 0;
    list.innerHTML = window.cart.map((item, index) => {
        let price = parseFloat(item.price.replace(/,/g, ''));
        total += price;

        // --- Custom Details Block Generator ---
        let metaHtml = '';
        if(item.isCustomItem) {
            
            // Check: Agar user ne image upload ki hai to HTML banao
            const uploadedImgHtml = item.details.uploadedImage 
                ? `<div style="margin-top:8px; padding-top:8px; border-top:1px dashed #ccc;">
                     <span style="font-size:10px; color:#777; display:block; margin-bottom:4px;">Reference Image:</span>
                     <img src="${item.details.uploadedImage}" style="width:60px; height:60px; object-fit:cover; border-radius:6px; border:1px solid #999;">
                   </div>` 
                : '';

            metaHtml = `
                <div style="font-size:11px; color:#444; background:#f4f4f4; padding:10px; border-radius:8px; margin-top:6px; line-height:1.5; border:1px solid #e0e0e0;">
                    <strong>Shape:</strong> ${item.details.shape} • <strong>Color:</strong> ${item.details.color}<br>
                    <strong>Size:</strong> ${item.details.size}<br>
                    <div style="color:#666; margin-top:2px; font-style:italic;">"${item.details.desc}"</div>
                    ${uploadedImgHtml} </div>
            `;
        } else if (item.isCustom) {
             metaHtml = `<span class="cart-custom-badge">Note: ${item.note}</span>`;
        }

        return `
        <div class="cart-item" style="align-items:flex-start">
            <img src="${item.image}" style="object-fit:cover; width:80px; height:80px; border-radius:10px;">
            
            <div class="cart-item-details">
                <div class="item-title">${item.name}</div>
                <div class="item-price">$${item.price}</div>
                ${metaHtml}
            </div>
            
            <div class="action-btn-icon" style="background:#fff5f5; color:#d32f2f;" onclick="removeCartItem(${index})">
                <i class="fas fa-trash"></i>
            </div>
        </div>`;
    }).join('');
    
    totalEl.innerText = "$" + total.toLocaleString(undefined, {minimumFractionDigits: 2});
};

        // --- CHECKOUT & ORDERS ---
        // --- 2. Update Confirm Order to match your Rules ---
        window.confirmOrder = async function () {
            const user = auth.currentUser;
            if (!user) return;

            const btn = document.getElementById('confirmOrderBtn');
            btn.innerHTML = 'Processing... <i class="fas fa-spinner fa-spin"></i>';
            btn.disabled = true;

            try {
                const orderId = "ORD-" + Date.now();
                const orderData = {
                    orderId: orderId,
                    userId: user.uid, // Still good to keep this
                    customerName: document.getElementById('chkName').value,
                    phone: document.getElementById('chkPhone').value,
                    address: document.getElementById('summaryAddr').innerText,
                    items: window.cart,
                    totalAmount: document.getElementById('checkoutTotal').innerText,
                    status: "Processing",
                    paymentMethod: "COD",
                    orderDate: new Date().toDateString(),
                    timestamp: Date.now()
                };

                // SAVE PATH CHANGED: Now saving inside 'users/{uid}/orders'
                // This matches your rule: ".write": "$uid === auth.uid"
                const updates = {};
                updates['users/' + user.uid + '/orders/' + orderId] = orderData;

                // Also update profile info
                updates['users/' + user.uid + '/phone'] = orderData.phone;
                updates['users/' + user.uid + '/address'] = document.getElementById('chkAddr').value;
                updates['users/' + user.uid + '/lastOrder'] = Date.now();
                updates['users/' + user.uid + '/cart'] = []; // Clear cart in cloud

                await update(ref(db), updates);

                // Success Handling
                window.cart = [];
                updateCartCount();
                document.getElementById('checkoutModal').style.display = 'none';

                // Close Cart Popup if open
                const cartPopup = document.getElementById('cartPopup');
                if (cartPopup.classList.contains('open')) cartPopup.classList.remove('open');

                document.getElementById('successModal').style.display = 'flex';

                setTimeout(() => {
                    document.getElementById('successModal').style.display = 'none';
                    window.navAction('orders');
                }, 3000);

            } catch (error) {
                console.error(error);
                window.showToast("Permission Error", error.message, "error");
            } finally {
                btn.innerHTML = "Confirm Order";
                btn.disabled = false;
            }
        };

        // --- AUTH & LOAD ---
        // --- FAST AUTH LOADING ---
onAuthStateChanged(auth, (user) => {
    const btn = document.querySelector('.header-profile-btn');
    if (user) {
        currentUser = user;
        // UI Turant Update karein
        btn.innerHTML = `<img src="${user.photoURL || 'https://via.placeholder.com/40'}" style="width:100%; height:100%; border-radius:50%;">`;
        document.getElementById('userPhoto').src = user.photoURL || 'https://via.placeholder.com/40';
        document.getElementById('userName').innerText = user.displayName;
        document.getElementById('userEmail').innerText = user.email;

        // Background Sync (Local data ko clear mat karo, merge karo!)
        get(ref(db, 'users/' + user.uid)).then((snapshot) => {
            if (snapshot.exists()) {
                const cloudData = snapshot.val();
                
                // Smart Merge: Agar local khali hai to cloud se lo
                if(window.cart.length === 0 && cloudData.cart) {
                    window.cart = cloudData.cart;
                    saveLocally();
                }
                if(window.wishlist.length === 0 && cloudData.wishlist) {
                    window.wishlist = cloudData.wishlist;
                    saveLocally();
                }
                updateCartCount();
            }
        });
        
        // Orders Listener start kar do background me
        window.renderOrders(); 

    } else {
        currentUser = null;
        btn.innerHTML = `<i class="far fa-user"></i>`;
    }
});

// Logout Update (Local Storage Clear karein)
document.getElementById('logoutBtn').addEventListener('click', () => {
    signOut(auth).then(() => {
        document.getElementById('userProfileModal').style.display = 'none';
        window.cart = []; window.wishlist = [];
        localStorage.removeItem('localCart'); // Clear Storage
        localStorage.removeItem('localWishlist'); // Clear Storage
        updateCartCount();
        window.navAction('home');
        window.showToast("Logged Out", "See you soon!", "info");
    });
});

        document.getElementById('googleLoginBtn').addEventListener('click', () => {
            signInWithPopup(auth, provider).then((res) => {
                const user = res.user;
                update(ref(db, 'users/' + user.uid), {
                    email: user.email, name: user.displayName, photo: user.photoURL, lastLogin: Date.now()
                });
                document.getElementById('authModal').style.display = 'none';
            }).catch(e => window.showToast(e.message));
        });
        document.getElementById('logoutBtn').addEventListener('click', () => {
            signOut(auth).then(() => {
                document.getElementById('userProfileModal').style.display = 'none';
                window.navAction('home');
            });
        });

        // --- ORDERS LIST ---
        // --- 3. Update Order List to read from User path ---
        // --- 3. Update Order List (Safe Version) ---
        // --- STEP 1: SAFE RENDER ORDERS (Paste this in your script) ---
        window.renderOrders = function () {
            const list = document.getElementById('ordersList');

            // Check Login
            if (!currentUser) {
                list.innerHTML = "<div class='empty-msg'>Login required</div>";
                return;
            }

            // Sirf tab loading dikhao jab list khali ho (Taaki update hone par blink na ho)
if(list.innerHTML.trim() === "") list.innerHTML = "<div class='empty-msg'>Loading...</div>";
            // Read Data
            const ordersRef = ref(db, 'users/' + currentUser.uid + '/orders');

            onValue(ordersRef, (snapshot) => {
                if (!snapshot.exists()) {
                    list.innerHTML = "<div class='empty-msg'>No orders yet</div>";
                    return;
                }

                list.innerHTML = "";
                const ordersData = snapshot.val();

                // Convert to Array & Sort
                const ordersArray = Object.values(ordersData);
                ordersArray.sort((a, b) => (b.timestamp || 0) - (a.timestamp || 0));

                ordersArray.forEach(o => {
                    // CRASH FIX: Check agar data kharab hai to skip karo
                    if (!o || !o.orderId) return;

                    // Safe ID Display
                    const displayId = o.orderId.length > 5 ? o.orderId.substr(4, 6) : 'ORD';

                    // Image Safety
                    const img = (o.items && o.items[0] && o.items[0].image) ? o.items[0].image : "https://via.placeholder.com/60";
                    const itemCount = o.items ? o.items.length : 0;
                    const dateStr = o.orderDate || 'Recent';

                    list.innerHTML += `
            <div class="order-card">
                <img src="${img}" class="order-img" onerror="this.src='https://via.placeholder.com/60'">
                <div class="order-info">
                    <div class="order-title">Order #${displayId}</div>
                    <div class="order-meta">${itemCount} Items • ${dateStr}</div>
                    <div class="order-status status-${o.status === 'Delivered' ? 'green' : 'orange'}">${o.status || 'Processing'}</div>
                </div>
                <div class="order-meta" style="color:#333;">${o.totalAmount || ''}</div>
            </div>`;
                });
            });
        };

        // --- NAVIGATION & HELPERS ---
        // --- Updated Navigation Logic ---
        window.navAction = function (action) {
            // 1. Close all existing popups
            document.querySelectorAll('.wishlist-popup, .cart-popup').forEach(p => p.classList.remove('open'));
            document.querySelector('.overlay').classList.remove('active');
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));

            // 2. Handle Actions
            if (action === 'home') {
                document.getElementById('nav-home').classList.add('active');
                // Home par koi popup nahi khulta
            }
            else if (action === 'shop') {
                document.getElementById('nav-store').classList.add('active'); // Highlight Icon

                // NEW: Open Store Popup
                renderStorePopup('All'); // Load data
                document.getElementById('storePopup').classList.add('open'); // Slide Up
                document.querySelector('.overlay').classList.add('active'); // Dark Background
            }
            else if (action === 'cart') {
                document.getElementById('nav-shop').classList.add('active');
                renderCart();
                document.getElementById('cartPopup').classList.add('open');
                document.querySelector('.overlay').classList.add('active');
            }
            else if (action === 'orders') {
                document.getElementById('nav-orders').classList.add('active');
                renderOrders();
                document.getElementById('ordersPopup').classList.add('open');
                document.querySelector('.overlay').classList.add('active');
            }
            else if (action === 'heart') {
                document.getElementById('nav-heart').classList.add('active');
                renderWishlist();
                document.getElementById('wishlistPopup').classList.add('open');
                document.querySelector('.overlay').classList.add('active');
            }
        };

        // --- 1. Fix the Checkout Button ---
        window.initiateCheckout = function () {
            // Check if cart is empty
            if (window.cart.length === 0) {
                window.showToast("Your bag is empty!");
                return;
            }
            // Check if user is logged in
            if (!currentUser) {
                document.getElementById('authModal').style.display = 'flex';
                return;
            }
            // Open Checkout Modal
            document.getElementById('checkoutModal').style.display = 'flex';
            document.getElementById('checkoutStep1').style.display = 'block';
            document.getElementById('checkoutStep2').style.display = 'none';
        };
        window.goToSummary = function () {
            const name = document.getElementById('chkName').value;
            const phone = document.getElementById('chkPhone').value;
            const addr = document.getElementById('chkAddr').value;
            if (!name || !phone || !addr) return window.showToast("Fill all details");
            document.getElementById('checkoutStep1').style.display = 'none';
            document.getElementById('checkoutStep2').style.display = 'block';
            document.getElementById('summaryName').innerText = name;
            document.getElementById('summaryPhone').innerText = phone;
            document.getElementById('summaryAddr').innerText = addr;
            document.getElementById('checkoutTotal').innerText = document.getElementById('cartTotal').innerText;
        };
        window.backToStep1 = () => { document.getElementById('checkoutStep2').style.display = 'none'; document.getElementById('checkoutStep1').style.display = 'block'; };

        // Global Close Handlers
        // --- Update: Close Popup & Reset to Home ---
        window.closePopup = (id) => {
            // 1. Popup aur Overlay ko chhupao
            document.getElementById(id).classList.remove('open');
            document.querySelector('.overlay').classList.remove('active');

            // 2. Saare icons se 'active' class hatao
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));

            // 3. Wapas 'Home' icon ko active (white circle) bana do
            document.getElementById('nav-home').classList.add('active');
        };
        window.openProfile = () => { if (auth.currentUser) document.getElementById('userProfileModal').style.display = 'flex'; else document.getElementById('authModal').style.display = 'flex'; };
        window.closeAuthModal = () => document.getElementById('authModal').style.display = 'none';
        window.closeUserModal = () => document.getElementById('userProfileModal').style.display = 'none';
        window.closeWizard = () => document.getElementById('wizardModal').style.display = 'none';
        window.closeCheckout = () => document.getElementById('checkoutModal').style.display = 'none';

        // Init
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof products !== 'undefined') window.loadProducts('Trending');
            else setTimeout(() => window.loadProducts('Trending'), 500);
        });
        // Overlay par click karne se bhi Home par wapas jayega
        document.getElementById('overlay').addEventListener('click', () => {
            document.querySelectorAll('.wishlist-popup, .cart-popup').forEach(p => p.classList.remove('open'));
            document.querySelector('.overlay').classList.remove('active');

            // Reset to Home
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('nav-home').classList.add('active');
        });
        // --- PREMIUM TOAST FUNCTION (With Swipe) ---
        window.showToast = function (title, message, type = 'info') {
            const container = document.getElementById('toastContainer');

            // 1. Create Elements
            const toast = document.createElement('div');
            toast.className = `toast-box toast-${type}`;

            // Icon selection
            let iconClass = 'fa-info-circle';
            if (type === 'success') iconClass = 'fa-check-circle';
            if (type === 'error') iconClass = 'fa-exclamation-circle';

            toast.innerHTML = `
        <i class="fas ${iconClass} toast-icon"></i>
        <div class="toast-content">
            <div class="toast-title">${title}</div>
            <div class="toast-msg">${message}</div>
        </div>
        <i class="fas fa-times toast-close" onclick="this.parentElement.remove()"></i>
    `;

            // 2. Add to Container
            container.appendChild(toast);

            // 3. Auto Remove after 4 seconds
            const autoRemove = setTimeout(() => {
                removeToast(toast);
            }, 4000);

            // 4. SWIPE TO DISMISS LOGIC (Touch Events)
            let startX = 0, startY = 0;
            let isDragging = false;

            toast.addEventListener('touchstart', (e) => {
                startX = e.touches[0].clientX;
                startY = e.touches[0].clientY;
                isDragging = true;
                toast.style.transition = 'none'; // Instant movement
            });

            toast.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                const currentX = e.touches[0].clientX;
                const currentY = e.touches[0].clientY;
                const diffX = currentX - startX;
                const diffY = currentY - startY;

                // Move the toast with finger (Only Up or Right)
                if (diffY < 0 || diffX > 0) {
                    e.preventDefault();
                    toast.style.transform = `translate(${diffX}px, ${diffY}px)`;
                    toast.style.opacity = `${1 - Math.abs(diffY) / 100}`; // Fade out effect
                }
            });

            toast.addEventListener('touchend', (e) => {
                isDragging = false;
                toast.style.transition = 'all 0.3s ease';

                const endX = e.changedTouches[0].clientX;
                const endY = e.changedTouches[0].clientY;
                const diffY = endY - startY;
                const diffX = endX - startX;

                // Agar user ne kaafi swipe kiya (Up > 50px or Right > 80px)
                if (diffY < -50 || diffX > 80) {
                    removeToast(toast); // Dismiss
                } else {
                    // Wapas reset karo (Snap back)
                    toast.style.transform = 'translate(0,0)';
                    toast.style.opacity = '1';
                }
            });

            // Helper to remove nicely
            function removeToast(el) {
                el.style.animation = 'toastFadeOut 0.3s forwards';
                setTimeout(() => { if (el.parentElement) el.remove(); }, 300);
                clearTimeout(autoRemove);
            }
        };
        // --- RENDER STORE POPUP (All Products) ---
        // --- RENDER STORE POPUP (Independent Logic) ---
        window.renderStorePopup = function (category = 'All', clickedBtn = null) {
            const grid = document.getElementById('storeGrid');

            // 1. UPDATE UI: Sirf Popup wale buttons ko change karo
            if (clickedBtn) {
                // Sirf 'store-chip' class walo se active hatao
                document.querySelectorAll('.store-chip').forEach(c => c.classList.remove('active'));
                // Jispar click kiya usse active karo
                clickedBtn.classList.add('active');
            }

            // 2. FILTER DATA
            let displayData = products;
            if (category !== 'All') {
                // Name ya Category match karo
                displayData = products.filter(p => p.category === category || p.name.includes(category));
            }

            // 3. RENDER (Baaki logic same rahega)
            if (displayData.length === 0) {
                grid.innerHTML = "<div class='empty-msg'>No items found.</div>";
                return;
            }

            grid.innerHTML = displayData.map(p => {
                const isLiked = window.wishlist.some(item => item.id === p.id) ? 'active' : '';
                return `
            <div class="product-card">
                <div class="prod-img-box">
                    <span class="fav-icon ${isLiked}" onclick="toggleLike(${p.id}, this)">
                        <i class="${isLiked ? 'fas' : 'far'} fa-heart"></i>
                    </span>
                    <span class="cart-btn-product" onclick="initiateAddToCart(${p.id})">
                        <i class="fas fa-plus"></i>
                    </span>
                    <img src="${p.image}" loading="lazy">
                </div>
                <div class="prod-details">
                    <div class="prod-title">${p.name}</div>
                    <div class="prod-price">$${p.price}</div>
                </div>
            </div>`;
            }).join('');
        };
        // --- CUSTOM BUILDER LOGIC ---
// --- PRO CUSTOM BUILDER LOGIC ---

// 1. STATE
let custData = {
    cat: '', shape: '', color: '', imageBase64: null
};

// 2. OPEN/CLOSE
window.openBuilder = () => {
    document.getElementById('promptModal').style.display = 'none';
    document.getElementById('customBuilderModal').style.display = 'flex';
    resetBuilderUI();
};
window.closeBuilder = () => document.getElementById('customBuilderModal').style.display = 'none';

function resetBuilderUI() {
    custData = { cat: '', shape: '', color: '', imageBase64: null };
    document.querySelectorAll('.b-opt, .s-opt, .c-circle').forEach(e => e.classList.remove('active'));
    document.getElementById('selectedColorName').innerText = "Select a color";
    document.getElementById('custDesc').value = "";
    document.getElementById('custLink').value = "";
    document.getElementById('sizeSection').style.display = 'none';
    document.getElementById('previewImg').style.display = 'none';
    document.getElementById('uploadText').innerText = "Upload Reference Image";
}

// 3. SELECTION HANDLERS
window.setCat = (el, cat) => {
    document.querySelectorAll('.b-opt').forEach(e => e.classList.remove('active'));
    el.classList.add('active');
    custData.cat = cat;

    // Size Logic: Standard vs Custom
    const section = document.getElementById('sizeSection');
    section.style.display = 'block';
    
    // Group A: Standard Size (Ring, Bangles, Pendant, Bracelet)
    const stdGroup = ['Ring', 'Bangles', 'Pendant', 'Bracelet'];
    
    if(stdGroup.includes(cat)) {
        document.getElementById('sizeStd').style.display = 'block';
        document.getElementById('sizeCust').style.display = 'none';
    } else {
        // Group B: Custom Slider (Inches)
        document.getElementById('sizeStd').style.display = 'none';
        document.getElementById('sizeCust').style.display = 'block';
    }
};

window.setShape = (el, shape) => {
    document.querySelectorAll('.s-opt').forEach(e => e.classList.remove('active'));
    el.classList.add('active');
    custData.shape = shape;
};

window.setColor = (el, color) => {
    document.querySelectorAll('.c-circle').forEach(e => e.classList.remove('active'));
    el.classList.add('active');
    custData.color = color;
    document.getElementById('selectedColorName').innerText = color + " Selected";
};

// 4. IMAGE HANDLING (File to Base64)
window.handleFileSelect = (input) => {
    if (input.files && input.files[0]) {
        const file = input.files[0];
        
        // Show Preview
        const reader = new FileReader();
        reader.onload = function(e) {
            document.getElementById('previewImg').src = e.target.result;
            document.getElementById('previewImg').style.display = 'block';
            document.getElementById('uploadText').innerText = "Image Selected";
            
            // Save Data
            custData.imageBase64 = e.target.result;
        };
        reader.readAsDataURL(file);
    }
};

// 5. SUBMIT TO CART
// --- UPDATED SUBMIT LOGIC (Fixes Image Issue) ---
window.submitCustomOrder = () => {
    // Validation
    if(!custData.cat || !custData.shape || !custData.color) {
        window.showToast("Incomplete", "Please select Category, Shape and Color.", "error");
        return;
    }

    // 1. Determine Size String
    let sizeFinal = "Standard (Fit for All)";
    const stdGroup = ['Ring', 'Bangles', 'Pendant', 'Bracelet'];
    if(!stdGroup.includes(custData.cat)) {
        const l = document.getElementById('txtLen').innerText;
        const b = document.getElementById('txtWid').innerText;
        sizeFinal = `${l}" x ${b}" (Inches)`;
    }

    // 2. Select Beautiful Default Image based on Category
    // Yeh image Cart ke LEFT side mein dikhegi (Main Product Image)
    const categoryImages = {
        'Ring': 'https://images.unsplash.com/photo-1605100804763-247f67b3557e?auto=format&fit=crop&w=500&q=60',
        'Bangles': 'https://images.unsplash.com/photo-1535632066927-ab7c9ab60908?auto=format&fit=crop&w=500&q=60',
        'Pendant': 'https://images.unsplash.com/photo-1599643478518-17488fbbcd75?auto=format&fit=crop&w=500&q=60',
        'Bracelet': 'https://images.unsplash.com/photo-1611591437281-460bfbe1220a?auto=format&fit=crop&w=500&q=60',
        'Mangalsutra': 'https://images.unsplash.com/photo-1515562141207-7a88fb7ce338?auto=format&fit=crop&w=500&q=60',
        'Keychain': 'https://images.unsplash.com/photo-1582562124811-2867e69f88d7?auto=format&fit=crop&w=500&q=60',
        'Frame': 'https://images.unsplash.com/photo-1534349762913-961129fdebe2?auto=format&fit=crop&w=500&q=60',
        'Mobile Case': 'https://images.unsplash.com/photo-1586105251261-72a756497a11?auto=format&fit=crop&w=500&q=60',
        'Keepsake': 'https://images.unsplash.com/photo-1513519245088-0e12902e5a38?auto=format&fit=crop&w=500&q=60'
    };
    
    // Agar category match na ho to fallback image
    const mainProductImage = categoryImages[custData.cat] || "https://images.unsplash.com/photo-1611591437281-460bfbe1220a?auto=format&fit=crop&w=500&q=60";

    // 3. Create Item Object
    const newItem = {
        id: 'CUST-' + Date.now(),
        name: `Custom ${custData.cat}`,
        price: "999.00",
        
        // MAIN CHANGE: Yahan ab default image jayegi, user ki upload nahi
        image: mainProductImage, 
        
        category: custData.cat,
        isCustomItem: true,
        details: {
            shape: custData.shape,
            color: custData.color,
            size: sizeFinal,
            desc: document.getElementById('custDesc').value || 'No Description',
            link: document.getElementById('custLink').value || '',
            
            // User ki Uploaded image yahan save hogi
            uploadedImage: custData.imageBase64 || null 
        }
    };

    // 4. Save & Close
    window.cart.push(newItem);
    updateCartCount();
    syncCartToCloud();
    closeBuilder();
    window.showToast("Design Added! 🎨", "Your custom jewelry is in the cart.", "success");
    
    setTimeout(() => window.navAction('cart'), 500);
};
// --- UPDATE: Make Product Cards Clickable ---
window.loadProducts = function(filterType = 'All') {
    const container = document.getElementById('productContainer');
    
    // ... (Purana filter logic same rahega) ...
    let displayList = [];
    if(filterType === 'Trending' || filterType === 'All') {
        if(filterType === 'All') displayList = products;
        else displayList = products.filter(p => p.isTrending);
    } else {
        displayList = products.filter(p => p.category === filterType || p.name.includes(filterType));
    }
    // ...

    container.innerHTML = displayList.map(p => {
        const isLiked = window.wishlist.some(item => item.id === p.id) ? 'active' : '';
        return `
            <div class="product-card" onclick="openProductDetail(${p.id})"> <div class="prod-img-box">
                    <span class="fav-icon ${isLiked}" onclick="event.stopPropagation(); toggleLike(${p.id}, this)">
                        <i class="${isLiked ? 'fas' : 'far'} fa-heart"></i>
                    </span>
                    <span class="cart-btn-product" onclick="event.stopPropagation(); initiateAddToCart(${p.id})">
                        <i class="fas fa-plus"></i>
                    </span>
                    <img src="${p.image}" loading="lazy">
                </div>
                <div class="prod-details">
                    <div class="prod-title">${p.name}</div>
                    <div class="prod-price">$${p.price}</div>
                </div>
            </div>`;
    }).join('');
};
// --- PRODUCT DETAIL POPUP LOGIC ---

let currentDetailProduct = null;

// --- UPDATED: OPEN DETAILS WITH REAL DATA ---
// --- UPDATED: OPEN DETAIL WITH SIMILAR PRODUCTS ---
window.openProductDetail = function(id) {
    const product = products.find(p => p.id === id);
    if (!product) return;

    currentDetailProduct = product;

    // 1. Populate Basic Info (Same as before)
    document.getElementById('detailTitle').innerText = product.name;
    document.getElementById('detailPrice').innerText = "$" + product.price;
    document.getElementById('detailCat').innerText = product.category;
    document.getElementById('detailDesc').innerText = product.description || "No description available.";

    // Images
    const imagesList = (product.images && product.images.length > 0) ? product.images : [product.image];
    document.getElementById('detailMainImg').src = imagesList[0];
    document.getElementById('detailThumbRow').innerHTML = imagesList.map((img, index) => `
        <img src="${img}" class="thumb-img ${index === 0 ? 'active' : ''}" onclick="switchDetailImage(this, '${img}')">
    `).join('');

    // Specs
    const specList = document.querySelector('.specs-list');
    specList.innerHTML = "";
    if(product.specs) {
        for (const [key, value] of Object.entries(product.specs)) {
            specList.innerHTML += `<li><span>${key}:</span> <span>${value}</span></li>`;
        }
    } else {
        specList.innerHTML = "<li><span>Info:</span> <span>Standard Specification</span></li>";
    }

    // Fav Button State
    const isLiked = window.wishlist.some(p => p.id === product.id);
    document.getElementById('detailFavBtn').innerHTML = isLiked ? '<i class="fas fa-heart" style="color:#e74c3c;"></i>' : '<i class="far fa-heart"></i>';

    // -----------------------------------------------------
    // 2. NEW: LOAD SIMILAR PRODUCTS
    // -----------------------------------------------------
    const similarContainer = document.getElementById('similarProductsRow');
    
    // Logic: Same category, but NOT the current product
    const similarItems = products.filter(p => p.category === product.category && p.id !== product.id);
    
    if(similarItems.length === 0) {
        similarContainer.innerHTML = "<div style='font-size:12px; color:#999;'>No similar items found.</div>";
    } else {
        similarContainer.innerHTML = similarItems.map(p => `
            <div style="min-width: 120px; cursor: pointer;" onclick="openProductDetail(${p.id})">
                <img src="${p.image}" style="width:100%; height:120px; object-fit:cover; border-radius:12px; margin-bottom:8px;">
                <div style="font-size:12px; font-weight:600; color:#333; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;">${p.name}</div>
                <div style="font-size:12px; font-weight:700; color:var(--primary-gold);">$${p.price}</div>
            </div>
        `).join('');
    }

    // Show Modal
    document.getElementById('productDetailModal').style.display = 'flex';
};

// --- UPDATED: ADD TO BAG (POPUP WON'T CLOSE) ---
// --- UPDATED: Add to Bag (Keep Popup Open) ---
window.addToCartFromDetail = function() {
    // 1. Check Login
    if(!currentUser) { 
        document.getElementById('authModal').style.display = 'flex'; 
        return; 
    }
    
    // 2. Add Item
    if(currentDetailProduct) {
        // Direct Add (Simple)
        window.cart.push({...currentDetailProduct, isCustom: false});
        updateCartCount();
        syncCartToCloud();
        
        // 3. Show Toast (Lekin Popup Close mat karo)
        window.showToast("Added to Bag 🛍️", "Item added to your cart.", "success");
        
        // Note: Humne yahan closeProductModal() call nahi kiya, isliye popup khula rahega.
    }
};

// Switch Image logic
window.switchDetailImage = function(el, src) {
    document.getElementById('detailMainImg').src = src;
    document.querySelectorAll('.thumb-img').forEach(img => img.classList.remove('active'));
    el.classList.add('active');
};

// Add to Cart from Details


// Toggle Fav from Details
// --- FIXED: TOGGLE FAV FROM DETAILS MODAL ---
window.toggleDetailFav = function() {
    // 1. Check Login
    if(!currentUser) { 
        document.getElementById('authModal').style.display = 'flex'; 
        return; 
    }

    if(!currentDetailProduct) return;

    const product = currentDetailProduct;
    
    // 2. Check if already in wishlist
    const idx = window.wishlist.findIndex(p => p.id === product.id);
    let isLiked = false;

    if(idx === -1) {
        // Add to Wishlist
        window.wishlist.push(product);
        isLiked = true;
    } else {
        // Remove from Wishlist
        window.wishlist.splice(idx, 1);
        isLiked = false;
    }
    
    // 3. Sync Cloud & Sidebar
    renderWishlist(); 
    syncWishlistToCloud();

    // 4. Update UI (Detail Modal Button)
    const favBtn = document.getElementById('detailFavBtn');
    if(isLiked) {
        favBtn.innerHTML = '<i class="fas fa-heart" style="color:#e74c3c;"></i>'; // Red Filled
        window.showToast("Added to Favourites", "Saved to your wishlist", "success");
    } else {
        favBtn.innerHTML = '<i class="far fa-heart"></i>'; // Outline
        window.showToast("Removed", "Removed from wishlist", "info");
    }

    // 5. Update Grid UI (Background me Home Page par bhi heart update karein)
    // Hum Home Page reload karke icons update kar dete hain taaki sync rahe
    window.loadProducts(document.querySelector('.filter-chip.active')?.innerText || 'All');
};

window.closeProductModal = function() {
    document.getElementById('productDetailModal').style.display = 'none';
};
    </script>
</body>

</html>
